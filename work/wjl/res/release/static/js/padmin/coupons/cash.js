var useArr={};seajs.use("calendar_css"),seajs.use(["$","select","confirmbox","calendar","autocomplete","util"],function(a,b,c,d,e,f){var g={setCal:function(){var a=new d({trigger:"#jStartTime"}),b=new d({trigger:"#jEndTime"});a.on("selectDate",function(a){b.range([a,null])}),b.on("selectDate",function(b){a.range([null,b])})},setSlt:function(){new b({trigger:"#qstate"}).render()},getCreateHtml:function(a){var b=['<div class="dialog-form">','<form action="relate.aj" id="j_create">','<div class="ui-form-item dialog-form-item">',"<label>券名称: </label>","<span>",a.couname,"</span>","</div>",'<div class="ui-form-item dialog-form-item">',"<label>券编号: </label>","<span>",a.counum,"</span>","</div>",'<div class="ui-form-item dialog-form-item">',"<label>商户名称: </label>","<span>",a.merchname,"</span>",'<div class="ui-form-explain"></div>',"</div>",'<input type="hidden" class="j-chan-storeid" value="',a.storeID,'" name="storeId" />','<input type="hidden" value="',a.tickNo,'" name="tickNo" />',"</form>","</div>"].join("");return b},auto:function(){var b=new e({trigger:a(".dialog-form .j-setorid"),dataSource:"/t/store/alist.aj?name={{query}}&t={{timestamp}}",locator:function(b){b=b||{};var c=b.data||{},d=c.list||{},e=[];return a.each(d,function(a,b){e.push({value:b.name,id:b.storeId}),useArr[b.storeId]=b.name}),e},submitOnEnter:!1,filter:function(b,c){return""==a.trim(c)?[]:b}}).render();b.element.css({"z-index":"10000"}),b.on("itemSelected",function(b){a(".dialog-form").find(".j-chan-storeid").val(b.id),a(".dialog-form").find(".j-chan-storeid").attr("data-value",b.id)}),a(".dialog-form .j-setorid").on("blur",function(){useArr[a(".dialog-form").find(".j-chan-storeid").data("value")]==a(this).val()||(a(this).val(""),a(this).data("value",""))})},bind:function(){a(".j-reconciliation").on("click",function(){var b,c=a(this).closest("tr").find("td").eq(1).text(),d=a(this).closest("tr").find("td").eq(2).text(),e=a(this).closest("tr").find("td").eq(4).text(),h=a(this).data("storeid"),i=a(this).data("tickno");b=g.getCreateHtml(e.length>0?{couname:c,counum:d,merchname:e,storeID:h,tickNo:i}:{couname:c,counum:d,merchname:'<input type="text" class="ui-input ui-input-large j-setorid" />',storeID:h,tickNo:i}),Util.confirm.open({title:"现金对账",message:b,confirmTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2" id="j_bt_yes">确定</span>',cancelTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2" id="j_bt_no">取消</span>',onConfirm:function(){a(".dialog-form").find(".j-chan-storeid").val()?g.sb({form:"#j_create",submitButton:"#j_bt_yes"}):a(".dialog-form").find(".ui-form-explain").css({color:"#ff5243"}).empty().html("请输入商户名称！")},onCancel:function(){f.confirm.close()},onClose:function(){}}),g.auto(),a(".dialog-form").find(".j-setorid").on("focus",function(){a(".dialog-form").find(".ui-form-explain").css({color:"#ff5243"}).empty()}),a(".dialog-form").find(".j-setorid").on("blur",function(){a(".dialog-form").find(".j-chan-storeid").val()||a(".dialog-form").find(".ui-form-explain").css({color:"#ff5243"}).empty().html("请输入商户名称！")})})},sb:function(a){f.formSend(a.form,{ajaxSuccess:function(a){f.go(a)},error:function(){f.alert("操作超时")},submitButton:a.submitButton})}},h=function(){g.setCal(),g.setSlt(),g.bind()};h(),$$m.finish("ok")});