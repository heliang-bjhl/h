$$m.length=4,seajs.use(["$","textLimit","select","util"],function(a,b,c,d){a(function(){function e(){this.list=[{e:"#sltPaymentType",msg:"帐号类型",key:null},{e:"#sltBank",msg:"银行类型",key:null},{e:"#txtAccount",msg:"帐号",key:null},{e:"#txtConfirmAccountAd",msg:"确认帐号",key:"#txtAccount"},{e:"#txtReturnFee",msg:"返佣比例",key:null}]}function f(){"银行"!=a("#sltPaymentType").val()?a(".J_addAccount").eq(1).hide():a(".J_addAccount").eq(1).show()}function g(){return 0==a("#tblList").length||arguments.callee.isBind===!0?!1:(arguments.callee.isBind=!0,void a("#tblList").click(function(b){var c=a(b.srcElement||b.target);c.is(".ui-button")&&window.confirm("确认删除")&&(c.parents("tr").first().remove(),a("#tblList tr").length<2&&a("#tblList").hide())}))}function h(b){var c=null,d=k;d=d.replace(/{(\w*)}/g,function(){return b[arguments[1]]}),0==a("#tblList").length?(c=j,c=c.replace(/{content}/g,d),a("#lblInfoBefore").after(c),g()):a("#tblList").show().find("tr:last").after(d)}d.limitnum({parentClass:".ui-form"}),new c({trigger:"#sltIndustry"}).render(),new c({trigger:"#sltPaymentType"}).render(),new c({trigger:"#sltBank"}).render(),new c({trigger:"#sltStartHour"}).render(),new c({trigger:"#sltStartMinute"}).render(),new c({trigger:"#sltEndHour"}).render(),new c({trigger:"#sltEndMinute"}).render(),new c({trigger:"#sltFloor"}).render(),b({input:"#txtDescription",tip:"#lblDescriptionMsg",msg:function(a){var b=a||{};return b.max-b.count<0?"输入已经超过了可允许的{max}字数":"还能输入{rest}个字"},max:1500,min:0,enableBr:!0,changeFn:function(){}}).init(),e.prototype={init:function(){var b=this;a.each(b.list,function(){b.add(this)})},add:function(b){var c=this;a(b.e).focus(function(){a(this).parents(".ui-form-item").first().removeClass("ui-form-item-error"),a(this).siblings(".ui-form-explain").html(b.msg+"是必"+("SELECT"==a(this).get(0).nodeName.toUpperCase()?"选择":"输入")+"项")}).blur(function(){c.validata.call(this,b)})},isError:function(){var b=this,c=!1;return a.each(b.list,function(){c=b.validata.call(a(this).get(0),this)||c}),c},validata:function(b){var c=!1;return a(b.e).is(":hidden")?void 0:(""==a.trim(a(b.e).val())?(c=!0,a(b.e).parents(".ui-form-item").first().removeClass("ui-form-item-success").addClass("ui-form-item-error"),a(b.e).siblings(".ui-form-explain").html(("SELECT"==a(b.e).get(0).nodeName.toUpperCase()?"请选择":"请输入")+b.msg)):(a(b.e).parents(".ui-form-item").first().removeClass("ui-form-item-error").addClass("ui-form-item-success"),a(b.e).siblings(".ui-form-explain").html(b.msg+"是必"+("SELECT"==a(b.e).get(0).nodeName.toUpperCase()?"选择":"输入")+"项")),c)}};var i=new e;i.init(),a("#btnAddAccount").bind("click",function(){a(".J_addAccount").eq(0).is(":visible")?a(".J_addAccount").hide():a(".J_addAccount").show(),f()}),setTimeout(function(){a('.ui-select[data-widget-cid="widget-15"]').on("click",function(){f()}),a("#sltPaymentType").on("change",function(){f()})},1500);var j=['<table class="ui-table" id="tblList">',"<tbody>","<tr>","<th>支付类型</th>","<th>帐号</th>","<th>返佣比例</th>",'<th class="hand">操作</th>',"</tr>{content}","</tbody>","</table>"].join(""),k=['<tr class="ui-table-split">',"<td>","{name}","</td>","<td>{card}</td>","<td>{returnFee}</td>",'<td class="hand">','<input type="button" class="ui-button ui-button-sorange" value="删除">',"</td>","</tr>"].join("");g(),a("#btnAccountList").click(function(){var b=!0,c=a.trim(a("#sltPaymentType").val()),e=a.trim(a("#sltBank").val()),f=a.trim(a("#txtReturnFee").val()),g=a.trim(a("#txtAccount").val()),j=(a.trim(a("#txtConfirmAccountAd").val()),c);return"银行"==c&&(j=e),i.isError()?!0:(a.each(a("#tblList tr:not(:first)"),function(){var c=a.trim(a(this).find("td:eq(0)").html()),d=a.trim(a(this).find("td:eq(1)").html());return c==j&&d==g?(b=!1,!1):void 0}),f+="%",b?(a("#txtReturnFee").val(""),a("#txtAccount").val(""),a("#txtConfirmAccountAd").val(""),void h({name:j,card:g,returnFee:f})):(d.alert("该帐号已经存在！"),!1))})}),$$m.itemok("ok")}),seajs.use(["$","uploadify","util","_"],function(a,b,c){a(function(){c.bindUpload("#uploader-1",{max:1,imgSize:"1024kb"}),c.bindUpload("#uploader-2",{imgSize:"500kb"})}),$$m.itemok("ok")}),seajs.use(["$","validator","util"],function(a,b,c){function d(){var b,d,e,f,g,h=[];try{if(a("#txtTelephoneOne").val()&&a("#txtTelephoneOne").val()&&(g=a("#txtTelephoneOne").val()+"-"+a("#txtTelephoneTwo").val()),0!=a("#uploadImg1").length&&a("#uploadImg1 > li").length<=1)return void a("#uploadImg1").closest(".ui-form-item-focus").find(".ui-form-explain").css({color:"#FF5243"}).text("请上传门店logo图片！");if(0!=a("#uploadImg2").length&&a("#uploadImg2 > li").length<=1)return void a("#uploadImg2").closest(".ui-form-item-focus").find(".ui-form-explain").css({color:"#FF5243"}).text("请上传店铺图片！");b=a("#sltStartHour").val()+":"+a("#sltStartMinute").val(),d=a("#sltEndHour").val()+":"+a("#sltEndMinute").val(),e=[],a.each(a("#tblList tr:not(:first)"),function(){var b=[];a.each(a(this).find("td:not(.hand)"),function(){b.push(a.trim(a(this).html()).replace(/%$/,""))}),e.push(b.join(","))}),f=a("#uploadImg1 .loaded-img").first().attr("data-src"),a.each(a("#uploadImg2 .loaded-img"),function(){h.push(a(this).attr("data-src"))});var i={storePay:e.join(";"),startTime:b,endTime:d,logo:f,piclist:h.join(",")};g&&(i.tel=g),c.formSend("#frmStoreCreate",{extraData:i,ajaxSuccess:function(a){var a=a||{};a.data&&a.data.url&&(location.href=a.data.url)},error:function(){c.alert("操作超时")},submitButton:"#btnSave"})}catch(j){c.alert(j.message||"系统出错了")}return!1}var e=new b({element:"#frmStoreCreate",onFormValidated:function(a){1!=a&&d()},autoSubmit:!1,failSilently:!0});e.addItem({element:"#txtStore",required:!0,errormessageRequired:"请输入门店名。"}).addItem({element:"#txtEmail",required:!1,errormessageRequired:"请输入正确的邮箱。"}).addItem({element:"#txtMobilePhone",required:!0,errormessageRequired:"请输入手机号。"}).addItem({element:"#sltIndustry",required:!0,errormessageRequired:"请选择行业。"}).addItem({element:"#txtCompany",required:!0,errormessageRequired:"请输入公司名。"}).addItem({element:"#txtBrand",required:!0,errormessageRequired:"请输入公司名。"}).addItem({element:"#txtAddress",required:!0,errormessageRequired:"请输入门店地址。"}).addItem({element:"#txtStation",required:!0,errormessageRequired:"请输入位置编号。"}).addItem({element:"#txtTelephoneOne",required:!0,errormessageRequired:"请输入电话的区号。"}).addItem({element:"#txtTelephoneTwo",required:!0,errormessageRequired:"请输入电话的号码。"}).addItem({element:"#txtSummary",required:!0,errormessageRequired:"请输入门店概要。"}).addItem({element:"#chargeMan",required:!0,errormessageRequired:"请输入负责人。"}),a("#txtDescription").length>0&&e.addItem({element:"#txtDescription",required:!0,errormessageRequired:"请输入详情描述。"}),$$m.itemok("ok")}),seajs.use(["$","setAnchor"],function(a,b){var c=['<div class="ui-select J_anchor" style="z-index: 99; position: fixed; left: 50%;margin-left:495px; top: 200px;">','<ul data-role="content" class="ui-select-content">',"{item}","</ul>","</div>"].join(""),d=[];a.each(a("h4"),function(){var b=a.trim(a(this).attr("id"));""==b&&(b="lblAnchor_"+parseInt(1e5*Math.random()),a(this).attr("id",b)),d.push('<li><a href="#'+b+'" class="ui-select-item  ui-select-selected">'+a.trim(a(this).html())+"</a></li>")}),c=c.replace(/{item}/g,d.join("")),b({ele:"h4",callback:function(b){a(".J_anchor").length<1&&a("body").append(c);var d=a(".J_anchor").find("li").eq(b);d.siblings().removeClass("anchor-selected"),d.addClass("anchor-selected")},offset:-20}).init(),$$m.itemok("ok")});