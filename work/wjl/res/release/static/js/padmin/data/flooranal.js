seajs.use("calendar_css"),seajs.use(["$","util","calendar"],function(a,b,c){var d={},e={setCal:function(){var a=b.getCurrentDate(),d=new c({trigger:"#j_searchTime1",range:[null,a]}),e=new c({trigger:"#j_searchTime2",range:[null,a]});d.on("selectDate",function(){e.range([null,a])}),e.on("selectDate",function(b){b._i;d.range([null,a])})},setChart1:function(a){var b={chart:{renderTo:"contain2",type:"column",animation:{duration:1e3}},subtitle:{text:"",align:"right",x:-10},legend:{enabled:!1},title:{text:"平均停留时间分层统计"},xAxis:{categories:a.floorArr},yAxis:{title:{text:"停留时长（分钟）"}},series:a.fullArr,credits:{enabled:0}};d.chart1=new Highcharts.Chart(b)},setChart2:function(b){a("#contain1").highcharts({title:{text:"连续7天分楼层日客流量对比"},subtitle:{text:""},xAxis:{categories:b.dataArr},yAxis:{title:{text:"人数"},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:"人"},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:b.floorArr})},getAjx1:function(){a.ajax({url:"/rpt_mall_flr_visit_index_d_visitors_by_floor/",dataType:"json"}).done(function(a){if(a&&200==a.code){for(var b={},c=a.data,f=[],g=0;g<c.length;g++)b[c[g].eve_day]||(b[c[g].eve_day]=1,f.push(c[g].eve_day)),b[a.data[g].floor]||(b[a.data[g].floor]=1);d.floordata={},d.realdatas={};for(var h=[],g=0;g<a.data.length;g++)d.floordata[a.data[g].floor]?d.realdatas[a.data[g].floor].data.push(parseInt(a.data[g].visitors)||0):(d.floordata[a.data[g].floor]=1,d.realdatas[a.data[g].floor]={},d.realdatas[a.data[g].floor].data=[parseInt(a.data[g].visitors)||0],d.realdatas[a.data[g].floor].name=a.data[g].floor);for(var i in d.floordata)h.push(d.realdatas[i]);e.setChart2({dataArr:f,floorArr:h})}else obj=!1}).fail(function(){})},sendAjax:function(b,c){a.ajax({url:"/rpt_mall_flr_visit_index_d_avg_staytime_by_floor",data:{day1:b,day2:c},dataType:"json"}).done(function(b){if(b&&200==b.code){d.chart1=null,a("#contain2").empty();for(var c=[],f=[],g=[],h=0;h<b.data1.length;h++)f.push(parseInt(b.data1[h].stay_time)||0),c.push(b.data1[h].floor);for(var i=0;i<b.data2.length;i++)g.push(parseInt(b.data2[i].stay_time)||0);var j={stack:"male",name:b.data1[0].event_day,data:f},k={stack:"male",name:b.data2[0].event_day,data:g},l=[j,k];e.setChart1({floorArr:c,fullArr:l})}}).fail(function(){})},bind:function(){a("#j_compare").on("click",function(){if(a("#j_searchTime1").val()&&a("#j_searchTime2").val()){var b=a("#j_searchTime1").val().split("-").join(""),c=a("#j_searchTime2").val().split("-").join("");e.sendAjax(b,c)}})}},f=function(){e.setCal(),e.getAjx1(),e.bind(),a("#j_compare").trigger("click")};f(),$$m.finish("ok")});