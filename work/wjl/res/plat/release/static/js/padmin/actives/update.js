seajs.use("calendar_css"),seajs.use(["$","textLimit","select","util","calendar","validator","uploadify","autocomplete","confirmbox"],function(a,b,c,d,e,f,g,h){var i={},j="frmUpdate";a("#frmStoreCreate").attr("id",j);var k=new f({element:"#"+j,onFormValidated:function(a){1!=a&&m.sb()},autoSubmit:!1,failSilently:!0}),l={},m={setSlt:function(){i.start_Time_Hour=new c({trigger:"#start_Time_Hour"}).render(),i.start_Time_Minute=new c({trigger:"#start_Time_Minute"}).render(),i.end_Time_Hour=new c({trigger:"#end_Time_Hour"}).render(),i.end_Time_Minute=new c({trigger:"#end_Time_Minute"}).render(),i.z_startDateHour=new c({trigger:"#z_startDateHour"}).render(),i.z_startDateMinute=new c({trigger:"#z_startDateMinute"}).render(),i.z_endDateHour=new c({trigger:"#z_endDateHour"}).render(),i.z_endDateMinute=new c({trigger:"#z_endDateMinute"}).render()},setCal:function(){var b=a("#z_startDate").val(),c=a("#z_endDate").val(),d=a("#start_Time").val(),f=a("#end_Time").val();if(b&&c)var g=new e({trigger:"#z_startDate",range:[null,c]}),h=new e({trigger:"#z_endDate",range:[b,null]});else var g=new e({trigger:"#z_startDate"}),h=new e({trigger:"#z_endDate"});if(d&&f)var i=new e({trigger:"#start_Time",range:[null,f]}),j=new e({trigger:"#end_Time",range:[d,null]});else var i=new e({trigger:"#start_Time"}),j=new e({trigger:"#end_Time"});g.on("selectDate",function(a){h.range([a,null])}),h.on("selectDate",function(a){g.range([null,a])}),i.on("selectDate",function(a){j.range([a,null])}),j.on("selectDate",function(a){i.range([null,a])})},getHtml:function(a){var b=['<div class="dialog-form">',"<p>",a,"</p>","</div>"].join("");return b},sb:function(){function b(){a(".m-upload").closest(".ui-form-item").addClass("ui-form-item-error").find(".ui-form-explain").text("必须上传主题图片。")}var c=[];if(a(".m-upload li").length<=1)return b();var c=[],e=d.timeToString({date:"#start_Time",hour:"#start_Time_Hour",minute:"#start_Time_Minute",type:"date"}),f=d.timeToString({date:"#end_Time",hour:"#end_Time_Hour",minute:"#end_Time_Minute",type:"date"}),g=d.timeToString({date:"#z_startDate",hour:"#z_startDateHour",minute:"#z_startDateMinute",type:"date"}),h=d.timeToString({date:"#z_endDate",hour:"#z_endDateHour",minute:"#z_endDateMinute",type:"date"});a(".j_tag:checked").each(function(){c.push(a(this).val())});var i=c.join(","),j=[];a.each(a("#uploadImg1 .loaded-img"),function(){j.push(a(this).attr("data-src"))});var k={startTime:e,endTime:f,activityPic:j.join(","),activityType:i};1==a("input[name=onlineRegistration]:checked").attr("value")?(k.registrarStartTime=g,k.registrarEndTime=h,-1==a("input[name=registrarLimit]:checked").attr("value")||a("input[name=registrarLimit]").attr("value",a("#c_no_need_memnum").val())):(a("input[name=registrarLimit]").attr("value","-1"),a("#c_no_need_memnum").val("")),d.formSend("#frmUpdate",{extraData:k,ajaxSuccess:function(a){1===a.code&&a.msg?Util.confirm.open({title:"操作有误",message:m.getHtml(a.msg),confirmTpl:"",cancelTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2">关闭</span>',width:300,onConfirm:function(){},onCancel:function(){d.confirm.close()},onClose:function(){}}):d.go(a)},error:function(){d.alert("操作超时")}})},setValidator:function(){k.addItem({element:"#z_subject",required:!0,rule:"maxlength{max: 50}",errormessageRequired:"活动主题为必填字段，最多50个字符。"}).addItem({element:"#z_spec",required:!0,rule:"maxlength{max: 50}",errormessageRequired:"活动特色为必填字段，最多50个字符。"}).addItem({element:"#z_place",required:!0,rule:"maxlength{max: 30}",errormessageRequired:"活动地点为必填字段，最多30个字符。"}).addItem({element:"#start_Time",required:!0,errormessageRequired:"活动时间为必填字段。"}).addItem({element:".j_tag",required:!0,errormessageRequired:"活动类型为必选。"}).addItem({element:"#end_Time",required:!0,errormessageRequired:"活动时间为必填字段。"})},setAc:function(){var b=new h({trigger:a("#z_bussinessnum"),dataSource:"/t/store/alist.aj?name={{query}}&t={{timestamp}}",locator:function(b){b=b||{};var c=b.data||{},d=c.list||{},e=[];return a.each(d,function(a,b){e.push({value:b.name,id:b.storeId}),l[b.storeId]=b.name}),e},submitOnEnter:!1,filter:function(b,c){return""==a.trim(c)?[]:b}}).render();b.on("itemSelected",function(b){a("#z_bussinessnum").data("value",b.value),a("#z_joinStoreId").val(b.id)}),a("#z_bussinessnum").on("blur",function(){a(this).data("value")==a(this).val()||(a(this).val(""),a(this).data("value",""))})},setChangeRadio:function(){"noneed"==a('input[name="onlineRegistration"]:checked').data("need")?a(".c_unsee").hide():"need"==a('input[name="onlineRegistration"]:checked').data("need")&&(a(".c_unsee").show(),k.addItem({element:"#z_startDate",required:!0,errormessageRequired:"报名时间为必填字段。"}).addItem({element:"#z_endDate",required:!0,errormessageRequired:"报名时间为必填字段。"}),a('input[name="registrarLimit"]').change(function(){k.removeItem("#registrar_limit"),a(this).data("chanval")&&(a(".c_unsee").show(),k.addItem({element:"#c_no_need_memnum",required:!0,errormessageRequired:"报名人数为必填字段。"}))}));var b=[{name:"organizer",input:"#z_bussinessnum",index:1},{name:"registrarLimit",input:"#c_no_need_memnum",index:1}];d.changeRadio(b),a('input[name="onlineRegistration"]').change(function(){if(k.removeItem("#z_startDate"),a('input[name="registrar_limit"]').unbind("change"),k.removeItem("#z_endDate"),k.removeItem("#c_no_need_memnum"),"need"==a(this).data("need")){a('input[name="registrar_limit"]').change(function(){k.removeItem("#c_no_need_memnum"),a(this).data("chanval")&&k.addItem({element:"#c_no_need_memnum",required:!0,errormessageRequired:"报名人数为必填字段。"})}),k.addItem({element:"#z_startDate",required:!0,errormessageRequired:"报名时间为必填字段。"}).addItem({element:"#z_endDate",required:!0,errormessageRequired:"报名时间为必填字段。"});var b=[{name:"c_no_need_memnum",input:"#registrar_limit",index:1}];d.changeRadio(b),a(".c_unsee").show()}else a(".c_unsee").hide()}),a('input[name="organizer"]').change(function(){k.removeItem("#z_bussinessnum"),a(this).data("chanval")&&k.addItem({element:"#z_bussinessnum",required:!0,errormessageRequired:"举办方为必填字段。"})})},setEdt:function(){m.ue=UM.getEditor("jedt",{toolbar:["bold","italic","underline","fontfamily","fontsize","paragraph","|","forecolor","backcolor","|","insertorderedlist","insertunorderedlist","|","justifyleft","justifyright","justifycenter","|","link","emotion"],autoHeightEnabled:!0,autoFloatEnabled:!0,initialFrameHeight:300,elementPathEnabled:!1,maximumWords:1e3}),m.ue.ready(function(){m.ue.addListener("blur",function(){m.setDetailValidator()}),m.setCon(a("#text_activityInfo").val())})},setCon:function(a){m.ue.setContent(a)},setDetailValidator:function(){{var b=m.ue.getContent();m.ue.getContentTxt()}""==b?a("#j_edt_box").addClass("ui-form-item-error"):a("#j_edt_box").removeClass("ui-form-item-error")}},n=function(){m.setChangeRadio(),m.setSlt(),m.setCal(),m.setValidator(),m.setEdt(),m.setAc(),d.bindUpload("#uploader-1",{imgSize:"500kb",max:6})};n(),d.limitnum({parentClass:".j-for-int-num",mold:"int"}),$$m.finish("ok")});