seajs.use("calendar_css"),seajs.use(["$","util","calendar"],function(a,b,c){var d={},e={setCal:function(){var a=b.getCurrentDate(),d=b.getDateRangeTime(a,-30),e=new c({trigger:"#jStartTime",range:[null,a]}),f=new c({trigger:"#jEndTime",range:[d,a]});e.on("selectDate",function(c){if(b.getDateRange(c,a)<=30)var d=c._i,e=a;else var d=c._i,e=b.getDateRangeTime(c._i,30);f.range([d,e])}),f.on("selectDate",function(a){var c=b.getDateRangeTime(a._i,-30),d=a._i;e.range([c,d])})},setChart3:function(b,c,e){a(function(){d.setChart3=new Highcharts.Chart({chart:{renderTo:"contain3",zoomType:"x"},title:{text:"发送条数走势"},xAxis:{tickInterval:5,title:{text:"日期"},labels:{},categories:b},yAxis:{title:{text:"短信条数"}},subtitle:{text:"总数"+e,align:"right",x:-10},credits:{enabled:0},series:[{name:"发送条数",data:c}]})})},setChart2:function(a){var b={chart:{renderTo:"contain2",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b><br/>{point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},title:{text:"短信类型比例"},tooltip:{},credits:{enabled:0},series:[{type:"pie",name:"比例",data:a}]};d.setChart2=new Highcharts.Chart(b)},setChart1:function(a){var b={chart:{renderTo:"contain1",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},plotOptions:{pie:{dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},title:{text:"接收对象比例"},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},credits:{enabled:0},series:[{type:"pie",name:"比例",data:a}]};d.setChart1=new Highcharts.Chart(b)},sendAjax:function(){var c=a("#jEndTime").val()||b.getCurrentDate(),f=a("#jStartTime").val()||b.getDateRangeTime(c,-30);a.ajax({url:"/t/sms/reportchart",data:{startTime:f,endTime:c}}).done(function(b){if(b&&200==b.code){var c=b.data.data;d.setChart1=null,d.setChart2=null,d.setChart3=null,a("#contain3").empty(),a("#contain2").empty(),a("#contain1").empty();var f=c.setChart3.categories,g=c.setChart3.xAxis,h=parseInt(c.setChart2[1]||0)+parseInt(c.setChart2[2]||0)+parseInt(c.setChart2[3]||0)+parseInt(c.setChart2[4]||0)+parseInt(c.setChart2[5]||0)+parseInt(c.setChart2[6]||0),i=[["活动告知",100*parseInt(c.setChart2[1]||0)/h],["新服务",100*parseInt(c.setChart2[2]||0)/h],["新品发布",100*parseInt(c.setChart2[3]||0)/h],["打折特价",100*parseInt(c.setChart2[4]||0)/h],["会员生日",100*parseInt(c.setChart2[5]||0)/h],["节日祝福",100*parseInt(c.setChart2[6]||0)/h]],j=parseInt(c.setChart1[1]||0)+parseInt(c.setChart1[2]||0)+parseInt(c.setChart1[3]||0),k=[["会员",100*parseInt(c.setChart1[1]||0)/j],["商户",100*parseInt(c.setChart1[2]||0)/j],["手输",100*parseInt(c.setChart1[3]||0)/j]];e.setChart3(f,g,j),e.setChart2(i),e.setChart1(k)}}).fail(function(){})},bind:function(){a("#j_subdatabtn").on("click",function(){e.sendAjax()})}},f=function(){e.setCal(),e.bind(),a("#j_subdatabtn").trigger("click")};f(),$$m.finish("ok")});