seajs.use(["$","confirmbox","util","autocomplete"],function(a,b,c,d){var e={},f={getSaveHtml:function(a){var b=['<div class="dialog-form">','<form action="save.aj" id="j_fsaveall">',"<p>是否确认保存</p>",'<input type="hidden" name="activityIds" value="',a,'" />',"</form>","</div>"].join("");return b},getNullHtml:function(){var a=['<div class="dialog-form">',"<p>请输入要添加的活动！</p>","</div>"].join("");return a},setAc:function(){var b=new d({trigger:a("#querySubject"),dataSource:"/t/recactives/query.aj?subject={{query}}",locator:function(b){b=b||{};var c=b.data||{},d=c.list||{},f=[];return a.each(d,function(a,b){f.push({value:b.activitySubject,id:b.activityId}),e[b.activityId]=b.activitySubject}),f},submitOnEnter:!1,filter:function(b,c){return""==a.trim(c)?[]:b}}).render();b.on("itemSelected",function(b){a("#querySubject").data("value",b.id),a("#activityId").val(b.id)}),a("#querySubject").on("blur",function(){e[a(this).data("value")]==a(this).val()||(a(this).val(""),a(this).data("value",""))})},bind:function(){a(".j_remove").on("click",function(){a(this).closest("tr").remove(),a("#z_save").hasClass("ui-button-lwhite")&&(a("#z_save").removeClass("ui-button-lwhite").addClass("ui-button-lorange"),a("#z_save").on("click",function(){var b=[];a("#tblList tbody tr").each(function(){a(this).data("actid")&&b.push(a(this).data("actid"))}),Util.confirm.open({title:"确认保存",message:f.getSaveHtml(b),confirmTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2" id="j_bt_yes">确定</span>',cancelTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2" id="j_bt_no">取消</span>',width:300,onConfirm:function(){f.sb({form:"#j_fsaveall",submitButton:"#j_bt_yes"})},onCancel:function(){c.confirm.close()},onClose:function(){}})}))}),a("#querySubject").on("keydown",function(b){var c;if(!b)var b=window.event;return b.keyCode?c=b.keyCode:b.which&&(c=b.which),13==c?(a("#querySubject").trigger("blur"),a("#btnAdd").trigger("click"),!1):void 0}),a("#btnAdd").on("click",function(){a("#querySubject").val()?f.sb({form:"#frmAdd",submitButton:"#btnAdd"}):Util.confirm.open({title:"提示：",message:f.getNullHtml(),confirmTpl:"",cancelTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2">关闭</span>',width:300,onConfirm:function(){},onCancel:function(){c.confirm.close()},onClose:function(){}})})},sb:function(a){c.formSend(a.form,{ajaxSuccess:function(a){c.go(a)},error:function(){c.alert("操作超时")},submitButton:a.submitButton})},sort:function(){a("#tblList").sortable({revert:!0,items:"tbody tr",update:function(){},change:function(){a("#z_save").hasClass("ui-button-lwhite")&&(a("#z_save").removeClass("ui-button-lwhite").addClass("ui-button-lorange"),a("#z_save").on("click",function(){var b=[];a("#tblList tbody tr").each(function(){a(this).data("actid")&&b.push(a(this).data("actid"))}),Util.confirm.open({title:"确认保存",message:f.getSaveHtml(b),confirmTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2" id="j_bt_yes">确定</span>',cancelTpl:'<span class="ui-dialog-button-orange ui-dialog-button-orange2" id="j_bt_no">取消</span>',width:300,onConfirm:function(){f.sb({form:"#j_fsaveall",submitButton:"#j_bt_yes"})},onCancel:function(){c.confirm.close()},onClose:function(){}})}))}})}},g=function(){f.bind(),f.sort(),f.setAc()};g(),$$m.finish("ok")});